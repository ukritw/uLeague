{{extend 'layout.html'}}
{{=form}}

<h4>Search result for {{=session.sport}}</h4>

<div class="span4 event_border event_filter marginleft_none" >
    <h5>Filter Search Result </h5>
    <hr>
    <form name="filter" enctype="multipart/form-data" action="{{=URL('search_result')}}" method="get">
        <p>Gender</p>
    		<input type="radio" name="sex" value="Male" >Male<br>
			<input type="radio" name="sex" value="Female" >Female<br><hr>
        <p>Date </p>
        	<input type="date" name="date" class="date" placeholder="{{=request.vars.date or "Month/Day/Year"}}">
        <hr>
        <p>Skill level</p>
            <select name="skill_level">
                <option value="None" selected>Select skill level</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        <hr>
        <p>Location</p>
        <input type="text" name="location" placeholder="{{=request.vars.location or ""}}" >
        <hr>
        <p>Name of event</p>
        	<input type="text" name="event_name" placeholder="{{=request.vars.event_name or ""}}" > <br>
        <br>
        <p id="filter-buttons">
            {{=A('Clear filter', _href=URL('search_result'), _class='btn btn-info')}}
            <input class="btn btn-success" type="submit" />
        </p>
	</form>
</div>
{{=H6('sport skill for searching: ',request.vars.skill_level)}}
<div style="float:left; margin-left: 40px;" >

	
{{event_count = 0}}
{{for i, event in enumerate(events):}}
 	{{if i==items_per_page: break}}
 	{{sportskill=db((db.sportskill.person == event.host) & (db.sportskill.sport == event.sport)).select().first()}}

    {{if (not request.vars.sex or event.host.gender == request.vars.sex) and (not request.vars.location or event.location == request.vars.location) and (not request.vars.event_name or event.name == request.vars.event_name) and (not request.vars.date or event.date_time.date().isoformat() >= request.vars.date) : }}

        {{if (sportskill != None) and (request.vars.skill_level != 'None'):}}
            {{if not request.vars.skill_level or (sportskill.level == float(request.vars.skill_level)) : }}
            
            {{=P('sport skill for person: ', sportskill.level)}}
            {{event_count += 1}}
            <a href="{{=URL('event', args=event.id)}}">
                <div style="border-style:solid; border-width:1px; margin-top:10px; " class="event_border">
                    {{=H6(event.name)}}
                    <ul style="list-style-type:none;"
                        
                        {{=LI(event.date_time)}}
                        {{=LI(event.date_time.date().isoformat())}}
                        {{=LI(event.location)}}
                        {{=LI(event.host.first_name+' '+event.host.last_name)}}
                        {{=LI(event.posting_date)}}
                        {{=LI(event.host.gender)}}
                        {{user = db.participation(person=auth.user_id,event=event.id)}}
                        {{if (event.host.id) == (auth.user_id): }}
                            {{=A('Delete Event', _href=URL('delete', args=[event.id]))}} <br/>
                            {{=A('Edit Event', _href=URL('event_edit', args=[event.id]))}} <br/>
                            
                        {{elif user != None: }}
                            {{=P('drop down menu')}}
                        	{{=participation_form}}
                            
                        {{else: }}
                            
                            {{=A('Join', _href=URL('join', args=[event.id, auth.user_id]))}} <br/>
                        {{pass}}
                    </ul>
              </div>
            </a>
            {{pass}}
        {{elif request.vars.skill_level == None:}}
            {{event_count += 1}}
            <a href="{{=URL('event', args=event.id)}}">
                <div style="border-style:solid; border-width:1px; margin-top:10px; " class="event_border">
                    {{=H6(event.name)}}
                    <ul style="list-style-type:none;"
                        
                        {{=LI(event.date_time)}}
                        {{=LI(event.date_time.date().isoformat())}}
                        {{=LI(event.location)}}
                        {{=LI(event.host.first_name+' '+event.host.last_name)}}
                        {{=LI(event.posting_date)}}
                        {{=LI(event.host.gender)}}
                        {{user = db.participation(person=auth.user_id,event=event.id)}}
                        {{if (event.host.id) == (auth.user_id): }}
                            {{=A('Delete Event', _href=URL('delete', args=[event.id]))}} <br/>
                            {{=A('Edit Event', _href=URL('event_edit', args=[event.id]))}} <br/>
                            
                        {{elif user != None: }}
                            {{=P('drop down menu')}}
                            {{=participation_form}}
                            
                        {{else: }}
                            
                            {{=A('Join', _href=URL('join', args=[event.id, auth.user_id]))}} <br/>
                        {{pass}}
                    </ul>
              </div>
            </a>
        {{pass}}
    {{pass}}
{{pass}}
{{if event_count == 0: }}
    	NO RESULT FOUND
	{{pass}}

</div>

<div style="float:left;" class="span8">
{{if page:}}
<a href="{{=URL(args=[page-1])}}">previous</a>
{{pass}}

{{if len(events)>items_per_page:}}
<a href="{{=URL(args=[page+1])}}">next</a>
{{pass}}
</div>
